# ehr-utils

The ehr-utils library provides some simple analytical capabilities for EHR data. The patient data and patient's lab data can be parsed and turned into usable dictionaries, as well as determining a patient's age and if a patient is sick, given user values as a reference.

### Users : Learning How to Use the Library

First the module must be imported. Run "pip install patient_parser".

The second step is to learn how to use the functions.

### Functions

#### parse_data

parse_data(patient_txt_file, lab_txt_file) -> patient_dictionary, lab_dictionary

parse_data takes in two text files. One represents the patient data which includes columns like patient id, date of birth, gender, marital status, race, language, and population percentage below poverty, amongst other columns. One represents the patient data which includes columns like patient id, date of birth, gender, marital status, race, language, and population percentage below poverty, amongst other columns. The lab file, the second text file, likely includes columns like the patient id, admission id, lab name, lab values, lab units, and lab datetime, amongst others. These two files are then processed by the function, which returns two corresponding dictionaries. The output for the patient file is a dictionary with the patient id as a key mapped to a dictionary of the columns described above as keys with the values mapped to them. The output for the lab file is a dictionary with the patient id as a key mapped to a list of dictionaries, which have the aformentioned columns as keys mapped to the values of those lab tests. Here are examples to help clarify the intent behind the wording.         

![image](https://user-images.githubusercontent.com/70504872/230887239-3eda5532-376a-4080-b985-fc07df130763.png)

An example of the output patient dictionary :

![image](https://user-images.githubusercontent.com/70504872/230888412-4a9ce6fa-aa9c-4284-b58f-8cdb4889eaa7.png)

An example of the output lab dictionary : 

![image](https://user-images.githubusercontent.com/70504872/230888740-46902e2b-d645-4b0b-804a-7bd9906c9e2b.png)

#### patient_age

patient_age(patient_dictionary : dict[str, dict[str, str]], patient_id : str) -> int

This function is very straightforward. It uses the patient dictionary generated by using parse data, identifies the date of birth and calculates the current age. 

![image](https://user-images.githubusercontent.com/70504872/230889384-460e4bf0-b9ec-46bb-93ab-2c976655ef2c.png)

#### patient_is_sick

patient_is_sick(lab_dictionary: dict[str, list[dict[str, str]]], patient_id: str, lab_name: str, operator: str, value: float) -> bool:

This function evaluates if a patient is sick based on a series of parameters. The lab dictionary is used to find the patient via the patient id. The lab name and the value to compare against are specified by the user. The available operators for comparison are ">"  and  "<". Here is an example.

![image](https://user-images.githubusercontent.com/70504872/230890360-6b6f3e21-379d-43dd-8e0e-ccbf15862b34.png)


### For Contributors : Testing

The unit tests evaluate parse_data, patien_age, and patient_is_sick with a series of assert statements, which are executed on fake files generated with the fake_files module. These files mimic the format of the patient files and lab files that are usually observed. If you identify use cases or add functions that meet your needs, make sure that the parsing of the data fits your overall requirements, given that it makes strong assumptions about the datetime strings (patient_age and patient_is_sick). 

The time complexity for parse_data is O(N x M) + O(K x L), where each first letter represents the rows and the second letter represents the columns of the files. N x M referst to the patient text file, and the K x L refers to the lab file. The patient_age function is constant time, and the patient_is_sick function is linear time. 

To run the tests as they are, simply run the scripts called test_parse_data, test_patient_age, test_patient_is_sick.
